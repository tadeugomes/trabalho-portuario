---
title: "Mercado de Trabalho no Setor Portuário - Maranhão"
author: "Observatório Portuário do Maranhão"
output:
  html_document:
    toc: true
    number_sections: true
    toc_float: true
    collapsed: true
    smooth_scroll: true
    toc_depth: 2
    keep_tex: yes
    fig_width: 12
    fig_height: 8
    fig_caption: true
    fig_align: center
    theme: cerulean
    highlight: kate
---


```{r child = "Setup.Rmd"}
#lendo arquivo Setup.Rmd
#optei por esta estratégia para plotar apenas os gráficos neste arquivo
#e pequenas operações
```


# Trabalhadores de Operações Portuárias

```{r n_grupo_cnae, include=FALSE, results='hide'}
dn <-
rais %>%
  group_by(n_grupo, ano) %>% 
  summarise(n = n()) %>% 
  mutate(n_grupo = fct_reorder(n_grupo, n)) %>% 
  arrange(desc(n)) %>% 
  top_n(10)
```


```{r g_denominacao,  echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
dn %>%
  filter(!is.na(n_grupo)) %>% 
ggplot(aes(x = ano, y = n, group = n_grupo)) +
  geom_line(aes(color = n_grupo), size = 2) +
  geom_point(aes(color = n_grupo), size = 4) +
  labs(x = "Ocupação", y = "Número de vínculos",
         caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        legend.text = element_text(size = 14L),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1,),
        legend.position = "top",
        legend.justification = c("left", "top"),
        legend.title = element_text(size = 16L, face = "bold")) +
  scale_colour_discrete(name = str_wrap("Grupos da CNAE", 10), labels = label_wrap_gen(width = 18))
  
```


```{r dados_uf_teste, include=FALSE, results='hide'}



uf <-
rais %>%
  filter(subclasse == "5231102") %>%
  group_by(sigla_uf, ano) %>%
  summarise(n = n()) %>%
  mutate(sigla_uf = fct_reorder(sigla_uf, n),
         fill = ifelse(sigla_uf == "MA", "um", "dois")) %>% 
  arrange(n)

ord_uf <- 
  uf %>% 
  filter(ano == 2010) %>% 
  select(sigla_uf) %>% 
  pull()

   uf <- uf %>% mutate(sigla_uf = factor(sigla_uf, levels = ord_uf))


```


O Brasil apresentou `r rais %>% filter(subclasse == "5231102") %>% group_by(sigla_uf) %>% 
    summarise(n = n()) %>% select(n) %>% sum() %>% comma(big.mark = ".", decimal.mark = ",")` vínculos de trabalho para a subclasse **Operações de Terminais**. São Paulo foi o estado com a maior quantidade de vínculos, ao todo foram `r uf %>% filter(n == max(n)) %>% select(n) %>% pull() %>% comma(big.mark = ".", decimal.mark = ",")` vínculos no estado. Rio de Janeiro, segundo estado com a maior quantidade de vículos, possuía cerca de `r uf %>% filter(n == nth(n, 2)) %>% select(n) %>% pull() %>% comma(big.mark = ".", decimal.mark = ",")`. O estado do Maranhão possuía `r uf %>% filter(sigla_uf == "MA") %>% select(n) %>% pull()  %>% comma(big.mark = ".", decimal.mark = ",")` vínculos.

```{r g_operacao_uf,  echo=FALSE, message=FALSE, warning=FALSE, results='hide', fig.width=8, fig.height=14}
uf %>%
  filter(!is.na(sigla_uf)) %>% 
ggplot(aes(x = sigla_uf, y = n/10^3,
           fill = fill, 
           size = .5))+
  geom_bar(position = "dodge", stat = "identity") +
  coord_flip() +
  labs(x = "Ocupação", y = "Número de vínculos (em mil)",
         caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  ggtitle(
    "Empregados na Operação de Terminais Portuários por estado", 
    subtitle = str_c(
      "São",
      uf %>% filter(ano == 2010) %>%  select(n) %>% pull() %>% sum() %>% comma(big.mark = ".", decimal.mark = ","),
      "vínculos de trabalho em todo o país em 2010 e", uf %>% filter(ano == 2020) %>%  select(n) %>% pull() %>% sum() %>% comma(big.mark = ".", decimal.mark = ","),  "vínculos em 2020",
      sep = " ")) +
theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position = "none")+
  # geom_text(aes(label= prettyNum(n, big.mark = ".", decimal.mark = ",")), 
  #           size =4,  
  #           hjust=-.5, vjust=.5, colour="black") +
  scale_fill_manual(values = c("lightblue", "#4682B4")) +
  scale_y_continuous(breaks = seq(0,12, 3), limits = c(0, 12),
                     labels = number_format(big.mark = ".", decimal.mark = ",")) +
  facet_wrap(~ano, ncol = 3)
       
```

## Escolaridade

```{r g_operacao_escol_sexo, results='hide', echo=FALSE, message=FALSE, warning=FALSE}
ordem_esc <- c("Fundamental incompleto", "Fundamental completo", 
        "Médio incompleto", "Médio completo", "Superior incompleto",
        "Superior completo", "Pós-graduação", "Não informado")

rais %>%
  filter(!is.na(grau_instrucao_apos_2005) & subclasse == "5231102") %>%
  group_by(grau_instrucao_apos_2005, sexo, .groups = 'drop') %>% 
  summarise(n = n()) %>% 
  mutate(grau_instrucao_apos_2005 = factor(grau_instrucao_apos_2005, levels = ordem_esc)) %>%
  ggplot(aes(x = grau_instrucao_apos_2005, y = n, fill = sexo)) +
  geom_bar(stat = "identity", 
          position=position_dodge2(reverse = TRUE), 
           show.legend = T, color = "black") +
  labs(title = "Escolaridade dos profissionais que atuam na Operação de Terminais Portuários no Brasil\npor sexo",
       x = "Grau de instrução", y = "Número de vínculos",
       caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  coord_flip() +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position="top",
        legend.title = element_text(face = "bold")
        )+
  geom_text(aes(x = grau_instrucao_apos_2005, y = n, label= prettyNum(n, big.mark = ".", decimal.mark = ",")),
            position = position_dodge2(width = 1, reverse = TRUE),
            size =4, vjust=.25, hjust = -.1,
           colour="black") +
  scale_y_continuous(breaks = seq(0,20000, 5000), limits = c(0, 20000),
                     labels = number_format(big.mark = ".", decimal.mark = ",")) +
  scale_fill_manual(values = alpha(c("#32cdc2", "#FFBF47"), 1), name = "Sexo")

```

```{r g_operacao_remuneracao_escol_sexo, results='hide', echo=FALSE, message=FALSE, warning=FALSE}

rais %>%
  filter(!is.na(grau_instrucao_apos_2005) & valor_remuneracao_media != 0.00  & subclasse == "5231102") %>%
  group_by(grau_instrucao_apos_2005, sexo, .groups = 'drop') %>% 
  summarise(n = n(),
            media = mean(valor_remuneracao_media)) %>% 
  mutate(grau_instrucao_apos_2005 = factor(grau_instrucao_apos_2005, levels = ordem_esc)) %>%
  ggplot(aes(x = grau_instrucao_apos_2005, y = media, fill = sexo)) +
  geom_bar(stat = "identity", 
          position=position_dodge2(reverse = T), 
           show.legend = T, color = "black") +
  labs(title = "Remuneração média dos profissionais que atuam na Operaçãode Terminais Portuários\nno Brasil por grau de escolaridade e sexo",
       x = "Grau de instrução", y = "Remuneração media",
       caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  coord_flip() +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position="top",
        legend.title = element_text(face = "bold")
        )+
  geom_text(aes(x = grau_instrucao_apos_2005, y = media, label= prettyNum(media, big.mark = ".", decimal.mark = ",", digits = 1)),
            position = position_dodge2(width = 1, reverse = T),
            size =4, vjust=.25, hjust = -.25,
           colour="black") +
  scale_y_continuous(
    breaks = seq(0,15000, 5000), limits = c(0, 15000),
    labels = label_number(big.mark = ".", decimal.mark = ",",
                                            prefix = "R$ ")) +
  scale_fill_manual(values = alpha(c("#32cdc2", "#FFBF47"), 1), name = "Sexo")

```


## Raça ou cor

```{r g_operacao_raca_sexo, results='hide', echo=FALSE, message=FALSE, warning=FALSE}

rais %>%
  filter(subclasse == "5231102") %>%
  group_by(raca_cor, sexo, .groups = 'drop') %>% 
  summarise(n = n()) %>% 
  ggplot(aes(x = raca_cor, y = n, fill = sexo)) +
  geom_bar(stat = "identity", 
          position=position_dodge2(reverse = TRUE), 
           show.legend = T, color = "black") +
  labs(title = "Quantidade dos profissionais que atuam na Operação de Terminais Portuários no Brasil\npor raça ou cor e sexo",
       x = "Raça ou cor", y = "Número de vínculos",
       caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  coord_flip() +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position="top",
        legend.title = element_text(face = "bold")
        )+
  geom_text(aes(x = raca_cor, y = n, label= prettyNum(n, big.mark = ".", decimal.mark = ",")),
            position = position_dodge2(width = 1, reverse = TRUE),
            size =4, vjust=.25, hjust = -.1,
           colour="black") +
  scale_y_continuous(breaks = seq(0,20000, 5000), limits = c(0, 20000),
                     labels = number_format(big.mark = ".", decimal.mark = ",")) +
  scale_fill_manual(values = alpha(c("#32cdc2", "#FFBF47"), 1), name = "Sexo")

```


```{r g_operacao_remuneracao_raca_sexo, results='hide', echo=FALSE, message=FALSE, warning=FALSE}

rais %>%
  filter(valor_remuneracao_media != 0.00  & subclasse == "5231102") %>%
  group_by(raca_cor, sexo, .groups = 'drop') %>% 
  summarise(n = n(),
            media = mean(valor_remuneracao_media)) %>% 
  ggplot(aes(x = raca_cor, y = media, fill = sexo)) +
  geom_bar(stat = "identity", 
          position=position_dodge2(reverse = T), 
           show.legend = T, color = "black") +
  labs(title = "Remuneração média dos profissionais que atuam na Operação de Terminais Portuários no Brasil\npor grau de escolaridade e raça ou cor",
       x = "Raça ou cor", y = "Remuneração média",
       caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  coord_flip() +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position="top",
        legend.title = element_text(face = "bold")
        )+
  geom_text(aes(x = raca_cor, y = media, label= prettyNum(media, big.mark = ".", decimal.mark = ",", digits = 1)),
            position = position_dodge2(width = 1, reverse = T),
            size =4, vjust=.25, hjust = -.25,
           colour="black") +
  scale_y_continuous(
    breaks = seq(0,20000, 5000), limits = c(0, 20000),
    labels = label_number(big.mark = ".", decimal.mark = ",",
                                            prefix = "R$ ")) +
  scale_fill_manual(values = alpha(c("#32cdc2", "#FFBF47"), 1), name = "Raça ou cor")

```

## Ocupações

```{r g_operacao_ocupacao, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
rais %>%
  filter(subclasse == "5231102") %>% 
  group_by(cbo_2002) %>% 
  summarise(n = n()) %>% 
  mutate(cbo_2002 = fct_reorder(cbo_2002, n)) %>% 
  arrange(desc(n)) %>% 
  top_n(10, n) %>% 
  ggplot(aes(x = cbo_2002, y = n))+
  geom_bar(fill = "lightblue", color = "black", position = "dodge", stat = "identity") +
  coord_flip() +
  labs(x = "Ocupação", y = "Número de vínculos",
         caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  ggtitle(
    "As 10 ocpupações  com a maior quantidade de vínculos na Operação de\n Terminais Portuários", 
    subtitle = str_c(
      "São",
      rais %>% filter(subclasse == "5231102") %>% group_by(cbo_2002) %>% 
    summarise(n = n()) %>% select(n) %>% sum() %>% comma(big.mark = ".", decimal.mark = ","),
      "vínculos de trabalho em todo o país",
      sep = " ")) +
theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position = "none")+
  geom_text(aes(label= prettyNum(n, big.mark = ".", decimal.mark = ",")), 
            size =4,  
            hjust=2, vjust=0.5, colour="black") +
  scale_y_continuous(breaks = seq(0,2500, 500), limits = c(0, 2500),
                     labels = number_format(big.mark = ".", decimal.mark = ","))
  
```

## Municípios

```{r g_operacao_municipio, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
rais %>%
  filter(subclasse == "5231102") %>% 
  group_by(nome_municipio) %>% 
  summarise(n = n()) %>% 
  mutate(nome_municipio = fct_reorder(nome_municipio, n)) %>% 
  arrange(desc(n)) %>% 
  top_n(20, n) %>% 
  ggplot(aes(x = nome_municipio, y = n))+
  geom_bar(fill = "lightblue", color = "black", position = "dodge", stat = "identity") +
  coord_flip() +
  labs(x = "Nome do município", y = "Número de vínculos",
         caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  ggtitle(
    "Os 20 municípios  com a maior quantidade de vínculos na Operação de\n Terminais Portuários", 
    subtitle = str_c(
      "São",
      rais %>% filter(subclasse == "5231102") %>% group_by(cbo_2002) %>% 
    summarise(n = n()) %>% select(n) %>% sum() %>% comma(big.mark = ".", decimal.mark = ","),
      "vínculos de trabalho em todo o país",
      sep = " ")) +
theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position = "none")+
  geom_text(aes(label= prettyNum(n, big.mark = ".", decimal.mark = ",")), 
            size =4,  
            hjust=1.5, vjust=0.5, colour="black") +
  scale_y_continuous(breaks = seq(0,6000, 2000), limits = c(0, 8000),
                     labels = number_format(big.mark = ".", decimal.mark = ","))
  
```

# Administração da Infraestrutura Portuária

```{r g_adm_uf, results='hide', echo=FALSE, message=FALSE, warning=FALSE}
rais %>%
  filter(subclasse == "5231101") %>% 
  group_by(sigla_uf) %>% 
  summarise(n = n()) %>% 
  mutate(sigla_uf = fct_reorder(sigla_uf, n),
         fill = ifelse(sigla_uf == "MA", "um", "dois")) %>%
ggplot(aes(x = sigla_uf, y = n,
           fill = fill, 
           size = .5))+
  geom_bar(stat="identity") +
  coord_flip() +
  labs(x = "UF", y = "Número de vínculos",
         caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  ggtitle(
    "Empregados na Administração da Infraestrura Portuária por estado", 
    subtitle = str_c(
      "São",
      rais %>% filter(subclasse == "5231101") %>% group_by(sigla_uf) %>% 
    summarise(n = n()) %>% select(n) %>% sum() %>% comma(big.mark = ".", decimal.mark = ","),
      "vínculos de trabalho em todo o país",
      sep = " ")) +
theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position = "none")+
  geom_text(aes(label= prettyNum(n, big.mark = ".", decimal.mark = ",")), 
            size =4,  
            hjust=-.5, vjust=0.5, colour="black") +
  scale_fill_manual(values = c("lightblue", "#4682B4")) +
  scale_y_continuous(breaks = seq(0,1200, 300), limits = c(0, 1200),
                     labels = number_format(big.mark = ".", decimal.mark = ","))
  
```

## Escolaridade

```{r g_adm_escol_sexo, results='hide', echo=FALSE, message=FALSE, warning=FALSE}

rais %>%
  filter(!is.na(grau_instrucao_apos_2005) & subclasse == "5231101") %>%
  group_by(grau_instrucao_apos_2005, sexo, .groups = 'drop') %>% 
  summarise(n = n()) %>% 
  mutate(grau_instrucao_apos_2005 = factor(grau_instrucao_apos_2005, levels = ordem_esc)) %>%
  ggplot(aes(x = grau_instrucao_apos_2005, y = n, fill = sexo)) +
  geom_bar(stat = "identity", 
          position=position_dodge2(reverse = T), 
           show.legend = T, color = "black") +
  labs(title = "Escolaridade dos profissionais que atuam na Administração da Infraestrutura Portuária\nno Brasil por sexo",
       x = "Grau de instrução", y = "Número de vínculos",
       caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  coord_flip() +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position="top",
        legend.title = element_text(face = "bold")
        )+
  geom_text(aes(x = grau_instrucao_apos_2005, y = n, label= prettyNum(n, big.mark = ".", decimal.mark = ",")),
            position = position_dodge2(width = 1, reverse = T),
            size =4, vjust=.25, hjust = -.25,
           colour="black") +
  scale_y_continuous(breaks = seq(0,1200, 400), limits = c(0, 1200),
                     labels = number_format(big.mark = ".", decimal.mark = ",")) +
  scale_fill_manual(values = alpha(c("#32cdc2", "#FFBF47"), 1), name = "Sexo")

```

```{r g_adm_remuneracao_escol_sexo, results='hide', echo=FALSE, message=FALSE, warning=FALSE}

rais %>%
  filter(!is.na(grau_instrucao_apos_2005) & valor_remuneracao_media != 0.00 & subclasse == "5231101") %>%
  group_by(grau_instrucao_apos_2005, sexo, .groups = 'drop') %>% 
  summarise(n = n(),
            media = mean(valor_remuneracao_media)) %>% 
  mutate(grau_instrucao_apos_2005 = factor(grau_instrucao_apos_2005, levels = ordem_esc)) %>%
  ggplot(aes(x = grau_instrucao_apos_2005, y = media, fill = sexo)) +
  geom_bar(stat = "identity", 
          position=position_dodge2(reverse = T), 
           show.legend = T, color = "black") +
  labs(title = "Escolaridade dos profissionais que atuam na Administração da Infraestrutura Portuária\nno Brasil por sexo",
       x = "Grau de instrução", y = "Remuneração média",
       caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  coord_flip() +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position="top",
        legend.title = element_text(face = "bold")
        )+
  geom_text(aes(x = grau_instrucao_apos_2005, y = media, label= prettyNum(media, big.mark = ".", decimal.mark = ",", digits = 1)),
            position = position_dodge2(width = 1, reverse = T),
            size =4, vjust=.25, hjust = -.05,
           colour="black") +
  scale_y_continuous(
    breaks = seq(0,16000, 5000), limits = c(0, 16000),
    labels = label_number(big.mark = ".", decimal.mark = ",",
                                            prefix = "R$ ")) +
  scale_fill_manual(values = alpha(c("#32cdc2", "#FFBF47"), 1), name = "Sexo")

```

## Raça ou cor

```{r g_adm_raca_sexo, results='hide', echo=FALSE, message=FALSE, warning=FALSE}

rais %>%
  filter(subclasse == "5231101") %>%
  group_by(raca_cor, sexo, .groups = 'drop') %>% 
  summarise(n = n()) %>% 
  ggplot(aes(x = raca_cor, y = n, fill = sexo)) +
  geom_bar(stat = "identity", 
          position=position_dodge2(reverse = TRUE), 
           show.legend = T, color = "black") +
  labs(title = "Quantidade dos profissionais que atuam na Administração da Infraestrutura Portuária no Brasil\npor raça ou cor e sexo",
       x = "Raça ou cor", y = "Número de vínculos",
       caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  coord_flip() +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position="top",
        legend.title = element_text(face = "bold")
        )+
  geom_text(aes(x = raca_cor, y = n, label= prettyNum(n, big.mark = ".", decimal.mark = ",")),
            position = position_dodge2(width = 1, reverse = TRUE),
            size =4, vjust=.25, hjust = -.1,
           colour="black") +
  scale_y_continuous(breaks = seq(0,1200, 400), limits = c(0, 1200),
                     labels = number_format(big.mark = ".", decimal.mark = ",")) +
  scale_fill_manual(values = alpha(c("#32cdc2", "#FFBF47"), 1), name = "Sexo")

```


```{r g_adm_remuneracao_raca_sexo, results='hide', echo=FALSE, message=FALSE, warning=FALSE}

rais %>%
  filter(valor_remuneracao_media != 0.00  & subclasse == "5231101") %>%
  group_by(raca_cor, sexo, .groups = 'drop') %>% 
  summarise(n = n(),
            media = mean(valor_remuneracao_media)) %>% 
  ggplot(aes(x = raca_cor, y = media, fill = sexo)) +
  geom_bar(stat = "identity", 
          position=position_dodge2(reverse = T), 
           show.legend = T, color = "black") +
  labs(title = "Remuneração média dos profissionais que atuam na Administração da Infraestrutura Portuária\nno Brasil por raça ou cor e sexo",
       x = "Raça ou cor", y = "Remuneração média",
       caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  coord_flip() +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position="top",
        legend.title = element_text(face = "bold")
        )+
  geom_text(aes(x = raca_cor, y = media, label= prettyNum(media, big.mark = ".", decimal.mark = ",", digits = 1)),
            position = position_dodge2(width = 1, reverse = T),
            size =4, vjust=.25, hjust = -.25,
           colour="black") +
  scale_y_continuous(
    breaks = seq(0,12000, 4000), limits = c(0, 15000),
    labels = label_number(big.mark = ".", decimal.mark = ",",
                                            prefix = "R$ ")) +
  scale_fill_manual(values = alpha(c("#32cdc2", "#FFBF47"), 1), name = "Raça ou cor")

```


## Ocupações

```{r g_adm_ocupacao, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
rais %>%
  filter(subclasse == "5231101") %>% 
  group_by(cbo_2002) %>% 
  summarise(n = n()) %>% 
  mutate(cbo_2002 = fct_reorder(cbo_2002, n)) %>% 
  arrange(desc(n)) %>% 
  top_n(10, n) %>% 
  ggplot(aes(x = cbo_2002, y = n))+
  geom_bar(fill = "lightblue", color = "#4682B4", position = "dodge", stat = "identity") +
  coord_flip() +
  labs(x = "Ocupação", y = "Número de vínculos",
         caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  ggtitle(
    "As 10 ocupações que com a maior quantidade de vínculos da Administração da\n Infraestrura Portuária  ", 
    subtitle = str_c(
      "São",
      rais %>% filter(subclasse == "5231101") %>% group_by(cbo_2002) %>% 
    summarise(n = n()) %>% select(n) %>% sum() %>% comma(big.mark = ".", decimal.mark = ","),
      "vínculos de trabalho em todo o país",
      sep = " ")) +
theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position = "none")+
  geom_text(aes(label= prettyNum(n, big.mark = ".", decimal.mark = ",")), 
            size =4,  
            hjust=2, vjust=0.5, colour="black") +
  scale_y_continuous(breaks = seq(0,650, 200), limits = c(0, 650),
                     labels = number_format(big.mark = ".", decimal.mark = ","))
  
```


## Municípios

```{r g_adm_municipio, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
rais %>%
  filter(subclasse == "5231101") %>% 
  group_by(nome_municipio) %>% 
  summarise(n = n()) %>% 
  mutate(nome_municipio = fct_reorder(nome_municipio, n)) %>% 
  arrange(desc(n)) %>% 
  top_n(20, n) %>% 
  ggplot(aes(x = nome_municipio, y = n))+
  geom_bar(fill = "lightblue", color = "black", position = "dodge", stat = "identity") +
  coord_flip() +
  labs(x = "Nome do município", y = "Número de vínculos",
         caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  ggtitle(
    "Os 20 municípios  com a maior quantidade de vínculos na Operação de\n Terminais Portuários", 
    subtitle = str_c(
      "São",
      rais %>% filter(subclasse == "5231102") %>% group_by(cbo_2002) %>% 
    summarise(n = n()) %>% select(n) %>% sum() %>% comma(big.mark = ".", decimal.mark = ","),
      "vínculos de trabalho em todo o país",
      sep = " ")) +
theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position = "none")+
  geom_text(aes(label= prettyNum(n, big.mark = ".", decimal.mark = ",")), 
            size =4,  
            hjust=-.5, vjust=0.5, colour="black") + 
  scale_y_continuous(breaks = seq(0,1000, 250), limits = c(0, 1000),
                     labels = number_format(big.mark = ".", decimal.mark = ","))
  
```
