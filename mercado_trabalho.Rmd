---
title: "Mercado de Trabalho no Setor Portuário brasileiro e maranhense"
author: "Observatório Portuário"
output:
  html_document:
    toc: true
    number_sections: true
    toc_float: true
    collapsed: true
    smooth_scroll: true
    toc_depth: 2
    keep_tex: yes
    fig_width: 14
    fig_height: 10
    fig_caption: true
    fig_align: center
    theme: cerulean
    highlight: kate
editor_options: 
  markdown: 
    wrap: 72
---

<style>
body {
text-align: justify}
</style>

```{r lendo, child = "Setup.Rmd"}
#lendo arquivo Setup.Rmd
#optei por esta estratégia para plotar apenas os gráficos neste arquivo
#e pequenas operações
```

# Introdução

O setor portuário brasileiro impacta direta e indiretamente os destinos
e a economia do país.

O Observatório Portuário apresenta neste relatório uma síntese da
evolução do Trabalho Portuário e Aguaviário no Brasil e no Maranhão.

Trata-se de um setor abrangente e com atividades diversas como
instalações portuárias, embarcações mercantes, de passageiros, pesca,
atividades em plataformas marítimas e de repação naval.

Como se trata de uma ampla gama de atividades, o relatório estará
organizado em duas seções com focos direcionados: a primeira com um
panorama abarcado pelo Trabalho Portuário e Aguaviário e a segunda com
um recorte específico sobre a operação e gestão portuária.

## Metodologia

Os dados apresentados neste relatório são originários da Relação Anual
de Informações Sociais (RAIS).

A RAIS é um registro administrativo que as organizações públicas e
privadas são obrigadas a enviar ao Ministério da Economia anualmente.
Seus dados, assim, abarcam estabelecimentos formais e permitem
identificar o estoque de vínculos formais de emprego (estatutários e
celetistas).

Este relatório apresenta os dados em uma perspectiva longitudinal:
apresenta os dados de 2010 a 2020.

O recorte dos dados sobre o trabalho portuário e aguaviário foi
realizado a partir da Classificação Nacional de Atividades Econômicas
(CNAE).

A CNAE é a classificação oficialmente adotada pelo Sistema Estatístico
Nacional e pelos órgãos federais gestores de registros administrativos e
está organizada em ordem decrescente de agregação das informações:
Seções, Divisões, Grupos, Classes e Subclasses.

A partir dessa divisão é possível mapear as atividades com trabalho
portuário e aguaviário e, especificamente, de operações e gestão
portuária.

Na tabela estão detalhadas as informações da CNAE utilizadas:

```{r tabela1, echo=FALSE, message=FALSE, warning=FALSE}
library(kableExtra)
options(knitr.table.format = "html")

rais %>% 
  filter(!is.na(n_subclasse)) %>% 
  select(secao, n_divisao, n_grupo, n_classe, n_subclasse) %>%
  mutate_if(is.factor, as.character) %>% 
  distinct(n_subclasse, .keep_all = T) %>% 
  arrange_all() %>% 
  kbl(align = "l", 
      booktabs = T,
      col.names = c("Seção", "Divisão", "Grupo", "Classe", "Subclasse"),
      escape = F,
      caption = "<center>Subclasses da Classificação Nacional de Atividades Econômicas 2.0 usadas <br> Seção H: Transporte, Armazenagem e Correio</center>") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>% 
  kable_paper(full_width = F) %>%
  column_spec(1, bold = T) %>%
  collapse_rows(columns = 1:4, valign = "top") %>% 
  footnote(general = "Observatório Portuário \nDados: IBGE - CNAE",
           alphabet_title = "Fonte: ",
            footnote_as_chunk = T) %>% 
  scroll_box(width = "100%", height = "400px")

```

# Panorama do trabalho no setor portuário e aquaviário no Brasil

Foram 76.350 vínculos registrados no setor portuário e aguaviário no
Brasil em 2020, de acordo com os dados da Relação Anual de Informações
Sociais (RAIS).

O número apresenta um decréscimo em relação aos anos anteriores,
sobretudo em relação ano de 2018, quando quase 80 mil vínculos foram
registrados. Considerando a tendência de queda do número de vínculos
identificada a partir de 2014, reitera-se a associação entre desempenho
das atividades econômicas do país e sua influência no estoque de
empregos do setor.

<br>

```{r g_secao,  echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
lvls_ano <- c("2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020")


g1<-
  rais %>%
  filter(!is.na(secao)) %>% 
  group_by(ano, secao) %>% 
  summarise(n = n()) %>% 
  mutate(ano = factor(ano, lvls_ano))

g1 %>% 
ggplot(aes(x = ano, y = n, group = secao)) +
  geom_line(aes(color = secao), size = 2) +
  geom_point(color = "black", size = 4) +
  ggrepel::geom_text_repel(aes(x = ano, y = n, label = scales::number(n, scale = 1/1000, decimal.mark = ",", big.mark = ".", accuracy = 0.01, suffix = " mil")), nudge_x = -0.2, direction = "y", hjust = "right", size = 4) +
  labs(x = "Ocupação", y = "Número de vínculos (em mil)",
       title = "Vínculos do Setor Portuário e Aguaviário no País (2010 - 2020)", subtitle = "",
         caption = "Fonte: Observatório Portuário - Dados da RAIS") +
  guides(color = "none") +
  bbc_style()+
   theme(plot.title = element_text(size = 15L, face = "bold"))
      

```

<br>

Ao analisar os dados por setor de atividade, verifica-se redução do
número de vínculos no grupo de profissionais atuantes nos (Divisão,
conforme nomenclatura da CNAE) **Transportes Aguaviários**, conforme se
verifica no gráfico, com uma redução de 44.420 mil vínculos em 2013 para
37.910 mil em 2020, com uma redução de 6.510 vínculos.

Por outro lado, nota-se que o grupo de atividades agrupadas como
**Armazenamento e Atividades Auxiliares dos Transportes** apresentou um
comportamento crescente no período, superando em 2020 o número de
vínculos no **Transporte Aguaviário**.

<br>

```{r g_divisao,  echo=FALSE, message=FALSE, warning=FALSE, results='hide', fig.height=14, fig.width=12}

g2 <- 
rais %>%
  filter(!is.na(n_divisao)) %>% 
  group_by(ano, n_divisao) %>% 
  summarise(n = n()) %>% 
  mutate(ano = factor(ano, lvls_ano)) 

g2 %>% 
ggplot(aes(x = ano, y = n, group = n_divisao)) +
  geom_line(aes(color = n_divisao), size = 2) +
  geom_point(color = "black", size = 3) +
  geom_point(
    data = . %>% group_by(n_divisao) %>% filter(n == max(n)), 
    aes(x = ano, y = n), 
    size = 3, color = "red") +
  geom_text_repel(aes(x = ano, y = n, label = scales::number(n, scale = 1/1000, decimal.mark = ",", big.mark = ".", accuracy = 0.01, suffix = " mil")), nudge_x = -0.2, direction = "y", hjust = "right", size = 4) +
  geom_text_repel(data = subset(g2, ano == 2020),
    aes(xend = ano, yend = n, label = str_wrap(n_divisao, 20), color = n_divisao), nudge_x = 2, nudge_y = -2, direction = "y", hjust = "left", size = 4, segment.curvature = -0.1, segment.ncp = 3, segment.angle = 2, segment.size = 2) +
  labs(x = "Ano", y = "Número de vínculos (em mil)",
         caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  labs(x = "Ocupação", y = "Número de vínculos (em mil)",
         caption = "Fonte: Observatório Portuário - Dados da RAIS") +
  theme_classic() +
  theme(plot.title = element_text(size = 20L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        legend.position = "none",
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1)) +
  scale_colour_discrete(name = str_wrap("Grupos da CNAE", 10), labels = label_wrap_gen(width = 18)) +
  scale_y_continuous(labels = label_number(scale = 1/1000)) +
  ggthemes::scale_color_gdocs()
  
```

<br>

Ao analisar os grupos de atividades com maiores vínculos, verifica-se o
destaque das atividades de **Armazenamento e Atividades Auxiliares dos
Transportes**, que compreende, de acordo com a CNAE, atividades
relacionadas

> [...] com a movimentação e o armazenamento de cargas, antes ou depois
> de seu transporte, ou entre segmentos de transporte de distintas
> modalidades, as atividades auxiliares das diversas modalidades de
> transporte envolvendo a operação da infraestrutura de suporte nas
> rodovias, ferrovias, aeroportos, portos, pontes túneis, etc. e as
> atividades de agenciamento de transporte. Esta divisão compreende
> também as atividades relacionadas à organização do transporte de
> carga.

Destaque também deve ser dado para o número de vínculos em **Navegação
de Apoio**, que abarca atividades como:

-   o transporte de mercadorias e pessoas para suprimento e apoio a
    navios e a plataformas de pesquisas e exploração de minerais e
    hidrocarbonetos;

-   a navegação realizada para apoio logístico a navios e a plataformas
    de exploração de minerais e hidrocarbonetos transporte;

-   a navegação realizada nos portos e terminais aquaviários, para
    atendimento a embarcações e instalações portuárias;

-   os serviços de reboque realizado por empresas de apoio marítimo;

-   os serviços de socorro e salvamento realizado por empresas de apoio
    portuário.

\
<br>

```{r g_grupo, echo=FALSE, message=FALSE, warning=FALSE}

# manipulação dos dados. Grupos CNAE
grupo <- 
  manipulacao(
    dataset = rais, 
    nivel1 = n_divisao, 
    nivel2 = n_grupo
  )

#grafico
a <- 
grafico(
  dataset = grupo,
  nivel1 = n_divisao, 
  nivel2 = n_grupo, 
  titulo = "", 
  titulo_legenda = ""
  )+
  bbc_style()+
  theme(plot.subtitle= element_blank(), 
            legend.text = element_text(size = 12), 
       panel.grid.major.x  = element_line(color = "black", linetype = 2, size = 0.1,),
       legend.position = "top",
       legend.justification = c("left", "top"),
       legend.title = element_text(size = 10, face = "bold"), 
       strip.text.x = element_text(size=12)
  )


print(a)
```

<br>

Observa-se que o grupo de **Transporte por Navegação Interior**
compreende atividades como *o transporte de carga municipal, por rios,
canais, lagos, lagoas, baias e outras vias de navegação interior, exceto
travessia* e *o fretamento de embarcações com tripulação*, mas não
inclui *a operação e gestão de terminais de carga*.

<br>

Além disso, a queda do número de vínculos em **Transporte Marítimo de
Cabotagem e Longo Curso** foi bastante acentuada, saindo de quase 9 mil
vínculos em 2010 para menos de 4 mil em 2020.

<br>

<br>

```{r  g_classe, echo=FALSE, message=FALSE, warning=FALSE, include=FALSE}
# manipulação dos dados
classe <- 
  manipulacao(
    dataset = rais, 
    nivel1 = n_grupo, 
    nivel2 = n_classe
  )


#grafico
a <- 
classe %>% 
grafico(
  nivel1 = n_grupo, 
  nivel2 = n_classe, 
  titulo = "Vínculos profissionais por setor de atuação", 
  titulo_legenda = "Classes da CNAE"
  )

print(a)


```

<br>

Ao detalhar as informações, verifica-se que houve acentuado aumento de
vínculos no Brasil nas **Operações Portuárias**, saltando de 14.760
vínculos para XXX, enquanto houve uma redução na **Administração da
Infra-Estrutura Portuária**, que em 2010 apresentava pouco mais de 5 mil
vínculos e apresentava apenas 3 mil em 2020.

**Continuar a descrição e melhorar a leitura do gráfico**

<br>

##### 

```{r funcao2, echo=FALSE, message=FALSE, warning=FALSE, fig.height=14, fig.width=14}
subclasse <- 
  manipulacao(
    dataset = rais, 
    nivel1 = n_classe, 
    nivel2 = n_subclasse
  )

#grafico
a <- 
subclasse %>% 
grafico(
  nivel1 = n_classe, 
  nivel2 = n_subclasse, 
  titulo = "", 
  titulo_legenda = ""
  )+ theme(plot.subtitle= element_blank(), 
            legend.text = element_text(size = 12), 
           strip.text.x = element_text(size=14))



print(a)

```

# Perfil do Trabalhador Portuário e Aquaviário

### Escolaridade do Trabalhador Portuário e Aguaviário

Ao analisar o perfil dos trabalhadores por sexo, observa-se que a participação masculina é destacada. Em 2020, do total de 76.317 vínculos, 65.735 eram homens, sendo apenas 10.582 mulheres (13,87%). 

Apesar da baixa participação feminina no setor, observa-se que apresentam maior escolaridade: 44,5% têm curso superior, contra 17,7% dos homens com a mesma escolaridade. 
De forma agregada, observa-se o aumento da escolarização entre 2010 e 2020, apesar do número de profissionais com pós-graduação ainda ser baixo.

```{r g_operacao_escol_sexo, results='hide', echo=FALSE, message=FALSE, warning=FALSE}
# ordem_esc <- c("Fundamental incompleto", "Fundamental completo", 
#         "Médio incompleto", "Médio completo", "Superior incompleto",
#         "Superior completo", "Pós-graduação", "Não informado")

escolaridade <- 
manipulacao(
    dataset = rais, 
    nivel1 = sexo, 
    nivel2 = grau_instrucao_apos_2005)

#grafico
a <- 
escolaridade %>% 
grafico(
  nivel1 = sexo, 
  nivel2 = grau_instrucao_apos_2005, 
  titulo = "Quantidade de Vínculos por grau de escolaridade e sexo (em mil)", 
  titulo_legenda = "Escolaridade"
  )

print(a)


```

```{r g_remun_escol_sexo, ,cache=FALSE, results='hide', echo=FALSE, message=FALSE, warning=FALSE, error=TRUE}

rem_esc_sexo <- 
  remuneracao_m(
    dataset = rais,
    nivel1 = sexo,
    nivel2 = grau_instrucao_apos_2005)

a <-
   grafico_remuneracao_m(
     dataset = rem_esc_sexo,
     nivel1 = sexo,
     nivel2 = grau_instrucao_apos_2005,
     titulo = "Vínculos por escolaridade e sexo (em mil)",
     titulo_legenda = ""
   )

```

### Raça ou cor do Trabalhador Portuário e Aguaviário

<<<<<<< HEAD
Como há uma discrepância da quantidade de vínculos das categorias de **raça ou cor** quando comparadas por **sexo**, optou-se pela **escala logarítmica**  no lugar da escala aritimética (escala habitual nos gráficos) para representar os dados quantidade de vínculos (**eixo y**) , pois a logarítmica permite, no caso do gráfico abaixo, uma visualização das tendências das quantidades de vínculos por cada raça ou cor ao longo dos anos analisados.




```{r g_operacao_raca_sexo, results='hide', echo=FALSE, message=FALSE, warning=FALSE}


rais %>%
  group_by(ano, raca_cor, sexo,) %>% 
  summarise(n = n()) %>% 
   mutate(raca_cor = forcats::fct_reorder(raca_cor, n)) %>% 
  mutate(ano = factor(ano, lvls_ano)) %>%
  ggplot(aes(x =ano, y = n, group = raca_cor, color = raca_cor)) +
   geom_line(size = 2) +
  geom_point(
    data = . %>% filter(ano %in% c(2010, 2020)),
      aes(x = ano, y = n), 
      color = "black", size = 5,
    show.legend = F) +
  geom_point(
    data = . %>%  group_by(raca_cor, sexo) %>% filter(n == max(n)),
      aes(x = ano, y = n), 
      color = "red", size = 5,
    show.legend = F) +
   geom_text_repel(
      data = . %>% filter(ano %in% c(2010, 2020)),
      aes(
        label = scales::number(
          n,
          scale = 1/10^3,
          accuracy = 0.01,
          suffix = " mil",
          decimal.mark = ",",
          big.mark = "."),
        ),
      size = 5,
      min.segment.length  =  0.5,
      box.padding  =  1,
      force = 8,
    ) +
  geom_text_repel(
        data = . %>% group_by(raca_cor) %>% filter(n == max(n)),
        aes(x =ano, y = n,
            label = scales::number(
            n,
            scale = 1/10^3,
            suffix = " mil",
            accuracy = 0.01,
            decimal.mark = ",",
            big.mark = "."
            )
          ),
        size = 5,
        min.segment.length  =  .5,
        box.padding  =  1,
        force =8,
      ) +
  scale_y_log10(labels = label_number(scale = 1/10^3,
            suffix = " mil",
            accuracy = 0.1,
            decimal.mark = ",",
            big.mark = ".")) +
  # scale_y_continuous(
  #   labels = label_number(scale = 1/1000, big.mark = ".", decimal.mark = ",")) +
    labs(x = "Ano", y = "Número de Vínculos", color = "Raça ou cor",
         caption = "Fonte: Observatório Portuário - Dados da RAIS") +
  facet_wrap(~sexo, scales = 'free_x', ncol = 2)+
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        #tema legenda
        legend.text = element_text(size = 14L),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1,),
        legend.position = "top",
        legend.justification = c("top"),
        legend.title = element_text(size = 16L, face = "bold"),
        #legend.background = element_rect(fill = "white", colour = "black"),
        legend.key.width = unit(1.5, "cm"),
        legend.key.height = unit(1.5, "cm"),
        #
  ) +
  guides(
    col = guide_legend(nrow = 1)) +
  ggthemes::scale_color_gdocs()
  #bbc_style()
 
```

```{r g_operacao_remuneracao_raca_sexo, results='hide', echo=FALSE, message=FALSE, warning=FALSE, include=FALSE}

rais %>%
  filter(valor_remuneracao_media != 0.00 | !is.na(valor_remuneracao_media)) %>%
  group_by(ano, raca_cor, sexo, .groups = 'drop') %>% 
  summarise(n = n(),
            media = mean(valor_remuneracao_media)) %>%
  mutate(ano = factor(ano, lvls_ano)) %>%
  ggplot(aes(x =ano, y = media, group = raca_cor, color = raca_cor)) +
   geom_line(size = 2) +
  geom_point(
    data = . %>% filter(ano %in% c(2010, 2020)),
      aes(x = ano, y = media), 
      color = "black", size = 5,
    show.legend = F) +
  geom_point(
    data = . %>%  group_by(raca_cor, sexo) %>% filter(media== max(media)),
      aes(x = ano, y = media), 
      color = "red", size = 5,
    show.legend = F) +
   geom_text_repel(
      data = . %>% group_by(raca_cor, sexo) %>%  filter(ano %in% c(2010, 2020)),
      aes(
        label = scales::number(
          media,
          scale = 1/10^3,
          accuracy = 0.01,
          suffix = " mil",
          decimal.mark = ",",
          big.mark = "."),
        ),
      size = 5,
      min.segment.length  =  0.5,
      box.padding  =  1,
      force = 8,
    ) +
  geom_text_repel(
        data = . %>% group_by(raca_cor, sexo) %>% filter(media == max(media)),
        aes(x =ano, y = media,
            label = scales::number(
            media,
            scale = 1/10^3,
            suffix = " mil",
            accuracy = 0.01,
            decimal.mark = ",",
            big.mark = "."
            )
          ),
        size = 5,
        min.segment.length  =  .5,
        box.padding  =  1,
        force =8,
      ) +
  scale_y_log10(labels = label_number(scale = 1/10^3,
            suffix = " mil",
            accuracy = 0.1,
            decimal.mark = ",",
            big.mark = ".")) +
  # scale_y_continuous(
  #   labels = label_number(scale = 1/1000, big.mark = ".", decimal.mark = ",")) +
    labs(x = "Ano", y = "Remuneração média (R$)", color = "Raça ou cor",
         caption = "Fonte: Observatório Portuário - Dados da RAIS") +
  facet_wrap(~sexo, scales = 'free_x', ncol = 2) +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        #tema legenda
        legend.text = element_text(size = 14L),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1,),
        legend.position = "top",
        legend.justification = c("top"),
        legend.title = element_text(size = 16L, face = "bold"),
        #legend.background = element_rect(fill = "white", colour = "black"),
        legend.key.width = unit(1.5, "cm"),
        legend.key.height = unit(1.5, "cm"),
        #
        ) +
  guides(
    col = guide_legend(nrow = 1)) +
  ggthemes::scale_color_gdocs()
```


```{r g_operacao_remuneracao _mediana_raca_sexo, results='hide', echo=FALSE, message=FALSE, warning=FALSE}

rais %>%
  filter(valor_remuneracao_media != 0.00 | !is.na(valor_remuneracao_media)) %>%
  group_by(ano, raca_cor, sexo, .groups = 'drop') %>% 
  summarise(n = n(),
            media = median(valor_remuneracao_media)) %>% 
  mutate(ano = factor(ano, lvls_ano)) %>%
  ggplot(aes(x =ano, y = media, group = raca_cor, color = raca_cor)) +
   geom_line(size = 2) +
  geom_point(
    data = . %>% filter(ano %in% c(2010, 2020)),
      aes(x = ano, y = media), 
      color = "black", size = 5,
    show.legend = F) +
  geom_point(
    data = . %>%  group_by(raca_cor, sexo) %>% filter(media== max(media)),
      aes(x = ano, y = media), 
      color = "red", size = 5,
    show.legend = F) +
   geom_text_repel(
      data = . %>% group_by(raca_cor, sexo) %>% filter(ano %in% c(2010, 2020)),
      aes(
        label = scales::number(
          media,
          scale = 1/10^3,
          accuracy = 0.01,
          suffix = " mil",
          decimal.mark = ",",
          big.mark = "."),
        ),
      size = 5,
      min.segment.length  =  0.5,
      box.padding  =  1,
      force = 8,
    ) +
  geom_text_repel(
        data = . %>% group_by(raca_cor, sexo) %>% filter(media == max(media)),
        aes(x =ano, y = media,
            label = scales::number(
            media,
            scale = 1/10^3,
            suffix = " mil",
            accuracy = 0.01,
            decimal.mark = ",",
            big.mark = "."
            )
          ),
        size = 5,
        min.segment.length  =  .5,
        box.padding  =  1,
        force =8,
      ) +
  scale_y_log10(labels = label_number(scale = 1/10^3,
            suffix = " mil",
            accuracy = 0.1,
            decimal.mark = ",",
            big.mark = ".")) +
  # scale_y_continuous(
  #   labels = label_number(scale = 1/1000, big.mark = ".", decimal.mark = ",")) +
    labs(x = "Ano", y = "Remuneração mediana (R$)", color = "Raça ou cor",
         caption = "Fonte: Observatório Portuário - Dados da RAIS") +
  facet_wrap(~sexo, scales = 'free_x', ncol = 2) +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        #tema legenda
        legend.text = element_text(size = 14L),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1,),
        legend.position = "top",
        legend.justification = c("top"),
        legend.title = element_text(size = 16L, face = "bold"),
        #legend.background = element_rect(fill = "white", colour = "black"),
        legend.key.width = unit(1.5, "cm"),
        legend.key.height = unit(1.5, "cm"),
        #
        ) +
  guides(
    col = guide_legend(nrow = 1)) +
  ggthemes::scale_color_gdocs()
```

## Ocupações dos Trabalhadores Portuários e Aquaviários

```{r g_operacao_ocupacao, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
rais %>%
  group_by(ano, cbo_2002) %>% 
  summarise(n = n()) %>% 
  mutate(ano = factor(ano, lvls_ano)) %>%
  arrange(n) %>% 
  top_n(6, n) %>% 
  ggplot(aes(x = ano, y = n, group = cbo_2002, color = cbo_2002)) +
  geom_line(size = 1.25) +
  geom_point(
    data = . %>% filter(ano %in% c(2010, 2020)),

      color = "black", size = 3) +
  geom_point(
    data = . %>%  group_by(cbo_2002) %>% filter(n == max(n)),
      aes(x = ano, y = n), 
      color = "red", size = 2) +
  #scale_color_manual(values = cores) +
  #scale_y_log10(labels = label_number(scale_cut = cut_short_scale())) +
  scale_y_continuous(
    labels = label_number(scale = 1/1000, big.mark = ".", decimal.mark = ",",
                                            prefix = "R$ ")) +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        legend.text = element_text(size = 14L),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1,),
        legend.position = "top",
        legend.justification = c("left", "top"),
        legend.title = element_text(size = 16L, face = "bold")) +
  labs(x = "Ano", y = "Remuneração média", color = "Ocupações",
         caption = "Fonte: Observatório Portuário - Dados da RAIS") +
    scale_colour_discrete(name = str_wrap("Grupos da CNAE", 10), labels = label_wrap_gen(width = 18)) +
  ggthemes::scale_color_gdocs()

 
  
```

## Remuneração Média dos Trabalhadores nos Estados

```{r g_operacao_estado, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
rais %>% 
  group_by(ano, nome_uf) %>% 
  summarise(n = n()) %>% 
  mutate(ano = factor(ano, lvls_ano)) %>%
  arrange(n, .by_group = T) %>% 
  top_n(7) %>% 
  ggplot(aes(x = ano, y = n, group = nome_uf, color = nome_uf)) +
   geom_line(size = 1.25) +
  geom_point(
    data = . %>%  group_by(nome_uf) %>% filter(ano %in% c(2010, 2020)),
      aes(x = ano, y = n), 
      color = "black", size = 3) +
  geom_point(
    data = . %>% filter(n == max(n)),
      aes(x = ano, y = n), 
      color = "red", size = 2) +
  scale_y_continuous(
    labels = label_number(scale = 1/1000, 
                          big.mark = ".", decimal.mark = ",")) +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        legend.text = element_text(size = 14L),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1,),
        legend.position = "top",
        legend.justification = c("left", "top"),
        legend.title = element_text(size = 16L, face = "bold")) +
  labs(x = "Ano", y = "Remuneração média", color = "",
         caption = "Fonte: Observatório Portuário - Dados da RAIS") +
    scale_colour_discrete(name = str_wrap("Grupos da CNAE", 10), labels = label_wrap_gen(width = 18)) +
  ggthemes::scale_color_gdocs()

  
```

## Remuneração Média dos Trabalhadores nos municípios

```{r g_operacao_municipio, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
rais %>% 
  group_by(ano, nome_municipio) %>% 
  summarise(n = n()) %>% 
  mutate(ano = factor(ano, lvls_ano)) %>%
  arrange(n) %>% 
  top_n(5, n) %>% 
  ggplot(aes(x = ano, y = n, group = nome_municipio, color = nome_municipio)) +
   geom_line(size = 1.25) +
  geom_point(
    data = . %>% filter(ano %in% c(2010, 2020)),
      aes(x = ano, y = n), 
      color = "black", size = 3) +
  geom_point(
    data = . %>%  group_by(nome_municipio) %>% filter(n == max(n)),
      aes(x = ano, y = n), 
      color = "red", size = 2) +
  scale_y_continuous(
    labels = label_number(big.mark = ".", decimal.mark = ",")) +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        legend.text = element_text(size = 14L),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1,),
        legend.position = "top",
        legend.justification = c("left", "top"),
        legend.title = element_text(size = 16L, face = "bold")) +
  labs(x = "Ano", y = "Remuneração média", color = "",
         caption = "Fonte: Observatório Portuário - Dados da RAIS") +
    scale_colour_discrete(name = str_wrap("Grupos da CNAE", 10), labels = label_wrap_gen(width = 18)) +
  scale_y_continuous(labels = label_number(scale = 1/1000)) +
    scale_colour_discrete(name = str_wrap("Grupos da CNAE", 10), labels = label_wrap_gen(width = 18)) +
  ggthemes::scale_color_gdocs()

```

# Trabalhadores da Gestão e Operação Portuária


```{r dados_uf_teste, include=FALSE, results='hide'}

uf <-
rais %>%
  group_by(ano, sigla_uf) %>%
  summarise(n = n()) %>%
  mutate(sigla_uf = fct_reorder(sigla_uf, n),
         fill = ifelse(sigla_uf == "MA", "um", "dois")) %>% 
  arrange(n)

ord_uf <- 
  uf %>% 
  filter(ano == 2010) %>% 
  select(sigla_uf) %>% 
  pull()

   uf <- uf %>% mutate(sigla_uf = factor(sigla_uf, levels = ord_uf))


```

O Brasil apresentou
`r rais %>% group_by(sigla_uf) %>%      summarise(n = n()) %>% select(n) %>% sum() %>% comma(big.mark = ".", decimal.mark = ",")`
vínculos de trabalho para a subclasse **Operações de Terminais**. São
Paulo foi o estado com a maior quantidade de vínculos, ao todo foram
`r uf %>% filter(n == max(n)) %>% select(n) %>% pull() %>% comma(big.mark = ".", decimal.mark = ",")`
vínculos no estado. Rio de Janeiro, segundo estado com a maior
quantidade de vículos, possuía cerca de
`r uf %>% filter(n == nth(n, 2)) %>% select(n) %>% pull() %>% comma(big.mark = ".", decimal.mark = ",")`.
O estado do Maranhão possuía
`r uf %>% filter(sigla_uf == "MA") %>% select(n) %>% pull()  %>% comma(big.mark = ".", decimal.mark = ",")`
vínculos.

```{r g_operacao_uf,  echo=FALSE, message=FALSE, warning=FALSE, results='hide', fig.width=8, fig.height=16}
uf %>%
  filter(!is.na(sigla_uf)) %>% 
ggplot(aes(x = sigla_uf, y = n,
           fill = fill, 
           size = .05))+
  geom_bar(position = "dodge", stat = "identity") +
  coord_flip() +
  labs(x = "Ocupação", y = "Número de vínculos (em mil)",
         caption = "Fonte: Observatório Portuário - Dados da RAIS") +
geom_text(
  data = . %>% group_by(ano) %>% slice_max(order_by = n, n = 3), 
    aes(label = scales::number(n, scale = 1/1000,  decimal.mark = ",", big.mark = ".", accuracy = .01, suffix = " mil")), hjust =  -.1, size = 2.5) +
  geom_text(
  data = . %>% filter(sigla_uf == "MA"), 
    aes(label = scales::number(n, scale = 1/1000,  decimal.mark = ",", big.mark = ".", accuracy = .01, suffix = " mil")), hjust =  -.1, size = 2.5) +
  ggtitle(
    "Empregados na Operação de Terminais Portuários por estado", 
    subtitle = str_c(
      "Eram",
      uf %>% filter(ano == 2010) %>%  select(n) %>% pull() %>% sum() %>% comma(big.mark = ".", decimal.mark = ","),
      "vínculos de trabalho em todo o país em 2010 e", uf %>% filter(ano == 2020) %>%  select(n) %>% pull() %>% sum() %>% comma(big.mark = ".", decimal.mark = ","),  "vínculos em 2020",
      sep = " ")) +
theme_classic() +
  theme(plot.title = element_text(size = 14L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 12L, face = "bold"), 
        axis.title.x = element_text(size = 12L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 10L),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1),
        legend.position = "none")+
  # geom_text(aes(label= prettyNum(n, big.mark = ".", decimal.mark = ",")), 
  #           size =4,  
  #           hjust=-.5, vjust=.5, colour="black") +
  scale_fill_manual(values = c("lightblue", "#4682B4")) +
  scale_y_continuous(
    breaks = seq(0,3*10^4, 10^4), limits = c(0, 3.5*10^4),
     labels = number_format(scale = 1/1000,
                                            big.mark = ".", decimal.mark = ",")) +
  facet_wrap(~ano, ncol = 3) 
       
```

# Panorama do trabalho no setor portuário e aquaviário no Maranhão

```{r, include=FALSE}
g1<-
  rais %>%
  filter(!is.na(secao) & sigla_uf == "MA") %>% 
  group_by(ano, secao) %>% 
  summarise(n = n()) %>% 
  mutate(ano = factor(ano, lvls_ano))
```


```{r g_secao_ma,  echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
lvls_ano <- c("2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020")



g1 %>% 
ggplot(aes(x = ano, y = n, group = secao)) +
  geom_line(aes(color = secao), size = 2) +
  geom_point(color = "black", size = 4) +
  ggrepel::geom_text_repel(aes(x = ano, y = n, label = scales::number(n, scale = 1/1000, decimal.mark = ",", big.mark = ".", accuracy = 0.01, suffix = " mil")), nudge_x = -0.2, direction = "y", hjust = "right", size = 4) +
  labs(x = "Ocupação", y = "Número de vínculos (em mil)",
       title = "Número de Vínculos do Setor Portuário e Aguaviário no Maranhão (2010 - 2020)", subtitle = "Seção da CNAE H",
         caption = "Fonte: Observatório Portuário - Dados da RAIS") +
  guides(color = "none") +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1)) + scale_y_continuous(labels = label_number(scale = 1/1000)) +
  ggthemes::scale_color_gdocs()
```

```{r g_divisao_ma,  echo=FALSE, message=FALSE, warning=FALSE, results='hide', fig.height=14, fig.width=12}

g2 <- 
rais %>%
  filter(!is.na(n_divisao) & sigla_uf == "MA") %>% 
  group_by(ano, n_divisao) %>% 
  summarise(n = n()) %>% 
  mutate(ano = factor(ano, lvls_ano)) 

g2 %>% 
ggplot(aes(x = ano, y = n, group = n_divisao)) +
  geom_line(aes(color = n_divisao), size = 2) +
  geom_point(color = "black", size = 3) +
  geom_point(
    data = . %>% group_by(n_divisao) %>% filter(n == max(n)), 
    aes(x = ano, y = n), 
    size = 3, color = "red") +
  geom_text_repel(aes(x = ano, y = n, label = scales::number(n, scale = 1/1000, decimal.mark = ",", big.mark = ".", accuracy = 0.01, suffix = " mil")), nudge_x = -0.2, direction = "y", hjust = "right", size = 4) +
  geom_text_repel(data = subset(g2, ano == 2020),
    aes(xend = ano, yend = n, label = str_wrap(n_divisao, 20), color = n_divisao), nudge_x = 2, nudge_y = -2, direction = "y", hjust = "left", size = 4, segment.curvature = -0.1, segment.ncp = 3, segment.angle = 2, segment.size = 2) +
  labs(x = "Ano", y = "Número de vínculos (em mil)",
         caption = "Fonte: Observatório Portuário do Maranhão - Dados da RAIS 2020") +
  labs(x = "Ocupação", y = "Número de vínculos (em mil)",
         caption = "Fonte: Observatório Portuário - Dados da RAIS") +
  theme_classic() +
  theme(plot.title = element_text(size = 16L, face = "bold"),
        plot.caption = element_text(size = 12L,face = "bold", hjust = 0), 
        axis.title.y = element_text(size = 14L, face = "bold"), 
        axis.title.x = element_text(size = 14L, face = "bold"),
        axis.text.x = element_text(size = 12L, face = "bold"),
        axis.text.y = element_text(size = 12L, face = "bold"),
        legend.position = "none",
        panel.grid.major.x  = element_line(color = "black", linetype = 3, size = 0.1)) +
  scale_colour_discrete(name = str_wrap("Grupos da CNAE", 10), labels = label_wrap_gen(width = 18)) +
  ggthemes::scale_color_gdocs() +
  scale_y_continuous(labels = label_number(scale = 1/1000))
  
```






